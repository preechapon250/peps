
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="light dark">
    <title>PEP 825 – Wheel Variants: Package Format | peps.python.org</title>
    <link rel="shortcut icon" href="../_static/py.png">
    <link rel="canonical" href="https://peps.python.org/pep-0825/">
    <link rel="stylesheet" href="../_static/style.css" type="text/css">
    <link rel="stylesheet" href="../_static/mq.css" type="text/css">
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" media="(prefers-color-scheme: light)" id="pyg-light">
    <link rel="stylesheet" href="../_static/pygments_dark.css" type="text/css" media="(prefers-color-scheme: dark)" id="pyg-dark">
    <link rel="alternate" type="application/rss+xml" title="Latest PEPs" href="https://peps.python.org/peps.rss">
    <meta property="og:title" content='PEP 825 – Wheel Variants: Package Format | peps.python.org'>
    <meta property="og:description" content="This PEP proposes variant wheels, an extension to packaging:specifications/binary-distribution-format that permits building multiple variants of the same package while embedding additional compatibility data. The specific properties are stored inside th...">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://peps.python.org/pep-0825/">
    <meta property="og:site_name" content="Python Enhancement Proposals (PEPs)">
    <meta property="og:image" content="https://peps.python.org/_static/og-image.png">
    <meta property="og:image:alt" content="Python PEPs">
    <meta property="og:image:width" content="200">
    <meta property="og:image:height" content="200">
    <meta name="description" content="This PEP proposes variant wheels, an extension to packaging:specifications/binary-distribution-format that permits building multiple variants of the same package while embedding additional compatibility data. The specific properties are stored inside th...">
    <meta name="theme-color" content="#3776ab">
</head>
<body>
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-sun-half" viewBox="0 0 24 24" pointer-events="all">
    <title>Following system colour scheme</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
         stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="9"></circle>
      <path d="M12 3v18m0-12l4.65-4.65M12 14.3l7.37-7.37M12 19.6l8.85-8.85"></path>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24" pointer-events="all">
    <title>Selected dark colour scheme</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
         stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24" pointer-events="all">
    <title>Selected light colour scheme</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
         stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
</svg>
    <script>

        document.documentElement.dataset.colour_scheme = localStorage.getItem("colour_scheme") || "auto"
    </script>
    <section id="pep-page-section">
        <header>
            <h1 data-pagefind-ignore>Python Enhancement Proposals</h1>
            <ul class="breadcrumbs">
                <li><a href="https://www.python.org/" title="The Python Programming Language">Python</a> &raquo; </li>
                <li><a href="../pep-0000/">PEP Index</a> &raquo; </li>
                <li>PEP 825</li>
            </ul>
            <button id="colour-scheme-cycler" onClick="setColourScheme(nextColourScheme())">
                <svg aria-hidden="true" class="colour-scheme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
                <svg aria-hidden="true" class="colour-scheme-icon-when-dark"><use href="#svg-moon"></use></svg>
                <svg aria-hidden="true" class="colour-scheme-icon-when-light"><use href="#svg-sun"></use></svg>
                <span class="visually-hidden">Toggle light / dark / auto colour theme</span>
            </button>
        </header>
        
        <div id="mobile-search" class="mobile-search-container"></div>
        
        <article data-pagefind-body>
            
            <span data-pagefind-meta="title:PEP 825 – Wheel Variants: Package Format" data-pagefind-weight="10" class="visually-hidden">PEP 825 – Wheel Variants: Package Format</span>
            <section id="pep-content">
<h1 class="page-title">PEP 825 – Wheel Variants: Package Format</h1>
<dl class="rfc2822 field-list simple">
<dt class="field-odd">Author<span class="colon">:</span></dt>
<dd class="field-odd">Jonathan Dekhtiar &lt;jonathan&#32;&#97;t&#32;dekhtiar.com&gt;,
Michał Górny &lt;mgorny&#32;&#97;t&#32;quansight.com&gt;,
Konstantin Schütze &lt;konstin&#32;&#97;t&#32;mailbox.org&gt;,
Ralf Gommers &lt;ralf.gommers&#32;&#97;t&#32;gmail.com&gt;,
Andrey Talman &lt;atalman&#32;&#97;t&#32;meta.com&gt;,
Charlie Marsh &lt;charlie&#32;&#97;t&#32;astral.sh&gt;,
Michael Sarahan &lt;msarahan&#32;&#97;t&#32;gmail.com&gt;,
Eli Uriegas &lt;eliuriegas&#32;&#97;t&#32;meta.com&gt;,
Barry Warsaw &lt;barry&#32;&#97;t&#32;python.org&gt;,
Donald Stufft &lt;donald&#32;&#97;t&#32;stufft.io&gt;,
Andy R. Terrel &lt;andy.terrel&#32;&#97;t&#32;gmail.com&gt;</dd>
<dt class="field-even">PEP-Delegate<span class="colon">:</span></dt>
<dd class="field-even">Paul Moore &lt;p.f.moore&#32;&#97;t&#32;gmail.com&gt;</dd>
<dt class="field-odd">Discussions-To<span class="colon">:</span></dt>
<dd class="field-odd"><a class="reference external" href="https://discuss.python.org/t/pep-817-split-wheel-variants-package-format/106196">Discourse thread</a></dd>
<dt class="field-even">Status<span class="colon">:</span></dt>
<dd class="field-even"><abbr title="Proposal under active discussion and revision">Draft</abbr></dd>
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><abbr title="Normative PEP with a new feature for Python, implementation change for CPython or interoperability standard for the ecosystem">Standards Track</abbr></dd>
<dt class="field-even">Topic<span class="colon">:</span></dt>
<dd class="field-even"><a class="reference external" href="../topic/packaging/">Packaging</a></dd>
<dt class="field-odd">Created<span class="colon">:</span></dt>
<dd class="field-odd">17-Feb-2026</dd>
<dt class="field-even">Post-History<span class="colon">:</span></dt>
<dd class="field-even"><a class="reference external" href="https://discuss.python.org/t/pep-817-split-wheel-variants-package-format/106196" title="Discourse thread">17-Feb-2026</a></dd>
</dl>
<hr class="docutils" />
<section id="contents">
<details><summary>Table of Contents</summary><ul class="simple">
<li><a class="reference internal" href="#abstract">Abstract</a></li>
<li><a class="reference internal" href="#motivation">Motivation</a></li>
<li><a class="reference internal" href="#specification">Specification</a><ul>
<li><a class="reference internal" href="#definitions">Definitions</a></li>
<li><a class="reference internal" href="#variant-wheel">Variant wheel</a></li>
<li><a class="reference internal" href="#variant-properties">Variant properties</a></li>
<li><a class="reference internal" href="#variant-label">Variant label</a></li>
<li><a class="reference internal" href="#variant-metadata">Variant metadata</a><ul>
<li><a class="reference internal" href="#schema">Schema</a></li>
<li><a class="reference internal" href="#default-priorities">Default priorities</a></li>
<li><a class="reference internal" href="#variants">Variants</a></li>
<li><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#index-level-metadata">Index-level metadata</a></li>
<li><a class="reference internal" href="#variant-ordering">Variant ordering</a></li>
<li><a class="reference internal" href="#environment-markers">Environment markers</a></li>
<li><a class="reference internal" href="#integration-with-pylock-toml">Integration with pylock.toml</a><ul>
<li><a class="reference internal" href="#proposed-specification-update">Proposed specification update</a><ul>
<li><a class="reference internal" href="#packages-variant-json"><code class="docutils literal notranslate"><span class="pre">[packages.variant_json]</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#id1">Example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#suggested-implementation-logic-for-tools-non-normative">Suggested implementation logic for tools (non-normative)</a><ul>
<li><a class="reference internal" href="#installing-a-package-from-an-index">Installing a package from an index</a></li>
<li><a class="reference internal" href="#installing-a-local-wheel">Installing a local wheel</a></li>
<li><a class="reference internal" href="#publishing-variant-wheels-on-an-index">Publishing variant wheels on an index</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#rationale">Rationale</a></li>
<li><a class="reference internal" href="#backwards-compatibility">Backwards Compatibility</a></li>
<li><a class="reference internal" href="#security-implications">Security Implications</a></li>
<li><a class="reference internal" href="#how-to-teach-this">How to Teach This</a></li>
<li><a class="reference internal" href="#reference-implementation">Reference Implementation</a></li>
<li><a class="reference internal" href="#rejected-ideas">Rejected Ideas</a><ul>
<li><a class="reference internal" href="#predictable-variant-labels">Predictable variant labels</a></li>
<li><a class="reference internal" href="#variant-label-as-part-of-platform-compatibility-tag">Variant label as part of Platform compatibility tag</a></li>
</ul>
</li>
<li><a class="reference internal" href="#open-issues">Open Issues</a></li>
<li><a class="reference internal" href="#acknowledgements">Acknowledgements</a></li>
<li><a class="reference internal" href="#change-history">Change History</a></li>
<li><a class="reference internal" href="#appendices">Appendices</a></li>
<li><a class="reference internal" href="#copyright">Copyright</a></li>
</ul>
</details></section>
<section id="abstract">
<h2><a class="toc-backref" href="#abstract" role="doc-backlink">Abstract</a></h2>
<p>This PEP proposes variant wheels, an extension to
<a class="reference external" href="https://packaging.python.org/en/latest/specifications/binary-distribution-format/" title="(in Python Packaging User Guide)"><span>Binary distribution format</span></a> that permits
building multiple variants of the same package while embedding
additional compatibility data. The specific properties are stored inside
the wheel, and expressed via a human-readable variant label in the
filename, which is then mapped to the actual properties via a separately
hosted JSON mapping. This aims to make <code class="docutils literal notranslate"><span class="pre">{tool}</span> <span class="pre">install</span> <span class="pre">{package}</span></code>
capable of selecting the most appropriate variant of packages where
additional compatibility dimensions such as GPU support need to be
accounted for.</p>
</section>
<section id="motivation">
<h2><a class="toc-backref" href="#motivation" role="doc-backlink">Motivation</a></h2>
<p>This PEP proposes a protocol to record additional compatibility data in
binary packages, to allow tools to pick the correct package to use in
situations where
<a class="reference external" href="https://packaging.python.org/en/latest/specifications/platform-compatibility-tags/" title="(in Python Packaging User Guide)"><span>Platform compatibility tags</span></a> are
insufficient. There are many cases where this is necessary, most notably
in the case of scientific and machine learning (ML) libraries, where
high performance requires extension code that is carefully tailored to
the precise hardware available in the user’s environment. Well known
examples of this include:</p>
<ul class="simple">
<li>PyTorch and other ML tools which depend on the user’s GPU hardware and
driver.</li>
<li>Scientific libraries like SciPy, which can be linked to different
linear algebra libraries.</li>
<li>Libraries such as XGBoost that can be linked to different OpenMP
runtimes.</li>
<li>Libraries that ship performance enhanced builds which can be used when
certain CPU instruction sets are available, such as AVX2 or AVX-512.</li>
</ul>
<p>The problem space has been explored in greater detail in <a class="pep reference internal" href="../pep-0817/" title="PEP 817 – Wheel Variants: Beyond Platform Tags">PEP 817</a>.</p>
</section>
<section id="specification">
<h2><a class="toc-backref" href="#specification" role="doc-backlink">Specification</a></h2>
<section id="definitions">
<h3><a class="toc-backref" href="#definitions" role="doc-backlink">Definitions</a></h3>
<p>The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”,
“SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL” in this
document are to be interpreted as described in <span class="target" id="index-0"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2119.html"><strong>RFC 2119</strong></a>.</p>
</section>
<section id="variant-wheel">
<h3><a class="toc-backref" href="#variant-wheel" role="doc-backlink">Variant wheel</a></h3>
<p>A variant wheel is an extension of the wheel format, defined in
<a class="reference external" href="https://packaging.python.org/en/latest/specifications/binary-distribution-format/" title="(in Python Packaging User Guide)"><span>Binary distribution format</span></a>. It
MUST specify a <a class="reference internal" href="#variant-label">variant label</a> in the filename, which makes it
distinct from non-variant wheels. It MUST include a
<a class="reference internal" href="#variant-metadata">variant metadata</a> file, which maps the variant label to zero or
more <a class="reference internal" href="#variant-properties">variant properties</a>.</p>
</section>
<section id="variant-properties">
<h3><a class="toc-backref" href="#variant-properties" role="doc-backlink">Variant properties</a></h3>
<p>Variant properties express the compatibility of binary packages with
specific platforms, in addition to
<a class="reference external" href="https://packaging.python.org/en/latest/specifications/platform-compatibility-tags/" title="(in Python Packaging User Guide)"><span>Platform compatibility tags</span></a>. They follow
a key-value format, where a key is called a <em>variant feature</em>. The
keys are further grouped into independently governed <em>variant
namespaces</em>. Hence, a variant feature consists of a namespace and a
feature name, whereas a variant property consists of a namespace, a
feature name and a feature value.</p>
<p>Variant properties are serialized into a structured 3-tuple of the
following format:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">namespace</span><span class="p">}</span> <span class="p">::</span> <span class="p">{</span><span class="n">feature_name</span><span class="p">}</span> <span class="p">::</span> <span class="p">{</span><span class="n">feature_value</span><span class="p">}</span>
</pre></div>
</div>
<p>The properties with which the wheel was built are stored within the
wheel, in the <a class="reference internal" href="#variant-metadata">variant metadata</a> file. A variant wheel can specify
multiple values corresponding to a variant feature. For the wheel to be
considered compatible with a system, at least one value for every
feature listed in its properties MUST be compatible with the system.
A variant wheel with zero properties is always deemed compatible.</p>
<p>The namespace and feature name components MUST be non-empty and consist
only of <code class="docutils literal notranslate"><span class="pre">0-9</span></code>, <code class="docutils literal notranslate"><span class="pre">a-z</span></code> and <code class="docutils literal notranslate"><span class="pre">_</span></code> ASCII characters (<code class="docutils literal notranslate"><span class="pre">^[a-z0-9_]+$</span></code>).
The feature value MUST be non-empty and consist only of <code class="docutils literal notranslate"><span class="pre">0-9</span></code>,
<code class="docutils literal notranslate"><span class="pre">a-z</span></code>, <code class="docutils literal notranslate"><span class="pre">_</span></code> and <code class="docutils literal notranslate"><span class="pre">.</span></code> ASCII Characters (<code class="docutils literal notranslate"><span class="pre">^[a-z0-9_.]+$</span></code>).</p>
<p>The available properties and the rules governing their compatibility
will be defined in a subsequent PEP.</p>
<p>Examples:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># the system must be compatible with all of the following
x86_64 :: level :: v3
x86_64 :: avx512_bf16 :: on
nvidia :: cuda_version_lower_bound :: 12.8
# it must also be compatible with at least one of the following
nvidia :: sm_arch :: 120_real
nvidia :: sm_arch :: 110_real
</pre></div>
</div>
</section>
<section id="variant-label">
<h3><a class="toc-backref" href="#variant-label" role="doc-backlink">Variant label</a></h3>
<p>The wheel filename template originally defined by <a class="pep reference internal" href="../pep-0427/" title="PEP 427 – The Wheel Binary Package Format 1.0">PEP 427</a> is changed
to:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>{distribution}-{version}(-{build tag})?-{python tag}-{abi tag}-{platform tag}(-{variant label})?.whl
                                                                             +++++++++++++++++++
</pre></div>
</div>
<p>Variant wheels MUST include the variant label component. Conversely,
wheels without variant label are non-variant wheels. The variant label
MUST be non-empty and consist only of <code class="docutils literal notranslate"><span class="pre">0-9</span></code>, <code class="docutils literal notranslate"><span class="pre">a-z</span></code>, <code class="docutils literal notranslate"><span class="pre">_</span></code> and <code class="docutils literal notranslate"><span class="pre">.</span></code>
ASCII characters (<code class="docutils literal notranslate"><span class="pre">^[0-9a-z_.]+$</span></code>).</p>
<p>Every variant label MUST uniquely correspond to a specific set of
variant properties, which MUST be the same for all wheels using the same
label within a single package version.</p>
<p>The label <code class="docutils literal notranslate"><span class="pre">null</span></code> is reserved and always corresponds to the variant
with zero properties, called a null variant. This variant acts as a
fallback variant that is always compatible.</p>
<p>Examples:</p>
<ul class="simple">
<li>Non-variant wheel:
<code class="docutils literal notranslate"><span class="pre">numpy-2.3.2-cp313-cp313t-musllinux_1_2_x86_64.whl</span></code></li>
<li>Wheel with variant label <code class="docutils literal notranslate"><span class="pre">x86_64_v3</span></code>:
<code class="docutils literal notranslate"><span class="pre">numpy-2.3.2-cp313-cp313t-musllinux_1_2_x86_64-x86_64_v3.whl</span></code></li>
<li>Null variant:
<code class="docutils literal notranslate"><span class="pre">numpy-2.3.2-cp313-cp313t-musllinux_1_2_x86_64-null.whl</span></code></li>
</ul>
</section>
<section id="variant-metadata">
<h3><a class="toc-backref" href="#variant-metadata" role="doc-backlink">Variant metadata</a></h3>
<p>The additional metadata specific to variant wheels is stored inside the
wheel, in <code class="docutils literal notranslate"><span class="pre">*.dist-info/variant.json</span></code> file, using the JSON format. This
PEP defines the following structure:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>+- $schema
+- default-priorities
|  +- namespace        : list[str]
|  +- feature
|     +- {namespace}   : list[str]  = []
|  +- property
|     +- {namespace}
|        +- {feature}  : list[str]  = []
+- variants
  +- {variant_label}
     +- {namespace}
        +- {feature}   : list[str]  = []
</pre></div>
</div>
<p>This structure corresponds to the version <code class="docutils literal notranslate"><span class="pre">0.1.0</span></code> of the format. The
version number is stored as part of the <a class="reference internal" href="#schema">schema</a> URL. Whenever the format
changes, the version number must be incremented. Tools MUST assume that
all variant wheels using an unknown format version are unsupported.</p>
<p>The version numbers starting with zero are reserved for drafts and MUST
NOT be used in production. Once the proposal is complete, the latest
draft will be promoted to version <code class="docutils literal notranslate"><span class="pre">1.0.0</span></code>.</p>
<p>The top-level keys are described in the subsequent sections.</p>
<section id="schema">
<h4><a class="toc-backref" href="#schema" role="doc-backlink">Schema</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">$schema</span></code> key is the standard way of specifying the <a class="reference external" href="https://json-schema.org/">JSON schema</a> used. Its value MUST be the URL of a JSON
schema corresponding to this specification, hosted on
<code class="docutils literal notranslate"><span class="pre">packaging.python.org</span></code>. The schema URL MUST include a version number,
and consequently every schema MUST describe the matching format version.
The schema can be used to verify the validity of the JSON file prior to
processing it, or after outputting it.</p>
<p>A proposed JSON schema for the current format version is included in the
Appendix of this PEP. Subsequent PEPs changing the metadata format will
include updated versions of the schema. The schema is available in
<a class="reference internal" href="appendix-variant-json-schema/#pep825-variant-json-schema"><span class="std std-ref">Appendix: JSON Schema for Variant Metadata</span></a>.</p>
</section>
<section id="default-priorities">
<h4><a class="toc-backref" href="#default-priorities" role="doc-backlink">Default priorities</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">default-priorities</span></code> dictionary defines the ordering of variants.
The exact algorithm is described in the <a class="reference internal" href="#variant-ordering">Variant ordering</a> section.</p>
<p>The following key is REQUIRED:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">namespace:</span> <span class="pre">list[str]</span></code>: All variant namespaces used in variant
wheels for a given package version, ordered in decreasing priority.
This list MUST contain all namespaces used in variant properties.</li>
</ul>
<p>It MAY have the following OPTIONAL keys:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">feature:</span> <span class="pre">dict[str,</span> <span class="pre">list[str]]</span></code>: A dictionary with namespaces as
keys, and ordered list of corresponding feature names as values.
The feature names are ordered in decreasing priority. It is used to
override the default feature ordering.</li>
<li><code class="docutils literal notranslate"><span class="pre">property:</span> <span class="pre">dict[str,</span> <span class="pre">dict[str,</span> <span class="pre">list[str]]]</span></code>: A nested dictionary
with namespaces as first-level keys, feature names as second-level
keys and ordered lists of corresponding property values as
second-level values. The feature values are ordered in decreasing
priority. It is used to override the default value ordering.</li>
</ul>
</section>
<section id="variants">
<h4><a class="toc-backref" href="#variants" role="doc-backlink">Variants</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">variants</span></code> dictionary provides a mapping from variant labels
to variant properties. In the variant wheel, it MUST contain the label
present in that wheel’s filename.</p>
<p>It has 3 levels. The first level keys are variant labels, the second
level keys are namespaces, the third level are feature names, and the
third level values are lists of feature values.</p>
</section>
<section id="example">
<h4><a class="toc-backref" href="#example" role="doc-backlink">Example</a></h4>
<div class="highlight-json5 notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="c1">// The schema URL will be replaced with the final URL on packaging.python.org</span>
<span class="w">  </span><span class="nv">&quot;$schema&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https://variants-schema.wheelnext.dev/peps/825/v0.1.0.json&quot;</span><span class="p">,</span>

<span class="w">  </span><span class="nv">&quot;default-priorities&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// REQUIRED: specifies that x86_64 CPU properties are more important than</span>
<span class="w">    </span><span class="c1">// aarch64 CPU properties (both are mutually exclusive, so the exact order</span>
<span class="w">    </span><span class="c1">// does not matter), and both are more important than specific BLAS/LAPACK</span>
<span class="w">    </span><span class="c1">// library:</span>
<span class="w">    </span><span class="nv">&quot;namespace&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;x86_64&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;aarch64&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;blas_lapack&quot;</span><span class="p">],</span>

<span class="w">    </span><span class="c1">// OPTIONAL: makes &quot;library&quot; the most important feature in &quot;blas_lapack&quot;</span>
<span class="w">    </span><span class="c1">// namespace</span>
<span class="w">    </span><span class="nv">&quot;feature&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nv">&quot;blas_lapack&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;library&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="p">},</span>

<span class="w">    </span><span class="c1">// OPTIONAL: makes [&quot;mkl&quot;, &quot;openblas&quot;] the most important values of</span>
<span class="w">    </span><span class="c1">// &quot;blas_lapack :: library&quot; feature</span>
<span class="w">    </span><span class="nv">&quot;property&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nv">&quot;blas_lapack&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nv">&quot;library&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;mkl&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;openblas&quot;</span><span class="p">]</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>

<span class="w">  </span><span class="nv">&quot;variants&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// REQUIRED: in variant.json, always a single entry, with the key</span>
<span class="w">    </span><span class="c1">// matching the variant label (&quot;x8664v3_openblas&quot;) and the value</span>
<span class="w">    </span><span class="c1">// specifying its properties (the system must be compatible with both):</span>
<span class="w">    </span><span class="c1">// - blas_lapack :: library :: openblas</span>
<span class="w">    </span><span class="c1">// - x86_64 :: level :: v3</span>
<span class="w">    </span><span class="nv">&quot;x8664v3_openblas&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nv">&quot;blas_lapack&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nv">&quot;library&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;openblas&quot;</span><span class="p">]</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nv">&quot;x86_64&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nv">&quot;level&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;v3&quot;</span><span class="p">]</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="index-level-metadata">
<h3><a class="toc-backref" href="#index-level-metadata" role="doc-backlink">Index-level metadata</a></h3>
<p>For every package version that includes at least one variant wheel,
there MUST exist a corresponding <code class="docutils literal notranslate"><span class="pre">{name}-{version}-variants.json</span></code>
file. The <code class="docutils literal notranslate"><span class="pre">{name}</span></code> and <code class="docutils literal notranslate"><span class="pre">{version}</span></code> placeholders correspond to the
package name and version, normalized according to the same rules as
wheel files, as found in the <a class="reference external" href="https://packaging.python.org/en/latest/specifications/binary-distribution-format/#wheel-file-name-spec" title="(in Python Packaging User Guide)"><span>File name convention</span></a> of
the Binary Distribution Format specification. The exact URL where the
file is hosted is insignificant, but a link to it MUST be present on all
index pages where the variant wheels are linked. It is presented in the
same simple repository format as source distribution and wheel links in
the index, including an (OPTIONAL) hash.</p>
<p>This file uses the same structure as <a class="reference internal" href="#variant-metadata">variant metadata</a>, except that
the <code class="docutils literal notranslate"><span class="pre">variants</span></code> object MUST list all variants available on the package
index for the package version in question. The tools MUST ensure that
the variant metadata across multiple variant wheels of the same package
version and the index-level metadata file is consistent. They MAY
require that keys other than <code class="docutils literal notranslate"><span class="pre">variants</span></code> have exactly the same values,
or they may carefully merge their values, provided that no conflicting
information is introduced, and the resolution results within a subset of
variants do not change.</p>
<p>This file SHOULD NOT be considered immutable and MAY be updated in a
backward compatible way at any point (e.g. when adding a new variant).</p>
<p>Variant indexes MAY elect to either auto-generate the file from the
uploaded variant wheels or allow the user to manually generate it
themselves and upload it to the index.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">foo-1.2.3-variants.json</span></code> corresponding to the package with two
wheel variants, one of them listed in the previous example, would look
like:</p>
<div class="highlight-json5 notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="c1">// The schema URL will be replaced with the final URL on packaging.python.org</span>
<span class="w">  </span><span class="nv">&quot;$schema&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https://variants-schema.wheelnext.dev/peps/825/v0.1.0.json&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nv">&quot;default-priorities&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// identical to above</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nv">&quot;variants&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// REQUIRED: entries for all wheel variants for the package version</span>

<span class="w">    </span><span class="c1">// if a null variant is present</span>
<span class="w">    </span><span class="nv">&quot;null&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span>

<span class="w">    </span><span class="c1">// &quot;x8664v3_openblas&quot; label corresponds to:</span>
<span class="w">    </span><span class="c1">// - blas_lapack :: library :: openblas</span>
<span class="w">    </span><span class="c1">// - x86_64 :: level :: v3</span>
<span class="w">    </span><span class="nv">&quot;x8664v3_openblas&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nv">&quot;blas_lapack&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nv">&quot;library&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;openblas&quot;</span><span class="p">]</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nv">&quot;x86_64&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nv">&quot;level&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;v3&quot;</span><span class="p">]</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>

<span class="w">    </span><span class="c1">// &quot;x8664v4_mkl&quot; label corresponds to:</span>
<span class="w">    </span><span class="c1">// - blas_lapack :: library :: mkl</span>
<span class="w">    </span><span class="c1">// - x86_64 :: level :: v4</span>
<span class="w">    </span><span class="nv">&quot;x8664v4_mkl&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nv">&quot;blas_lapack&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nv">&quot;library&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;mkl&quot;</span><span class="p">]</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nv">&quot;x86_64&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nv">&quot;level&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;v4&quot;</span><span class="p">]</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="variant-ordering">
<h3><a class="toc-backref" href="#variant-ordering" role="doc-backlink">Variant ordering</a></h3>
<p>To determine which variant wheel to install when multiple wheels are
compatible, variants MUST be totally ordered by their variant
properties.</p>
<p>For the purpose of ordering, variant properties are grouped into
features, and features into namespaces. For every namespace, the tool
MUST obtain an ordered list of compatible features, and for every
feature, an ordered list of compatible values. The method of obtaining
these lists will be defined in a subsequent PEP.</p>
<p>The default ordering MUST be performed equivalent to the following
algorithm:</p>
<ol class="arabic">
<li>Construct the ordered list of namespaces by copying the value of the
<code class="docutils literal notranslate"><span class="pre">default-priorities.namespace</span></code> key from <a class="reference internal" href="#index-level-metadata">index-level metadata</a>.
This is <code class="docutils literal notranslate"><span class="pre">namespace_order</span></code> in the example.</li>
<li>For every namespace:<ol class="lowerroman simple">
<li>Construct the initial ordered list of feature names by copying the
value of the respective <code class="docutils literal notranslate"><span class="pre">default-priorities.feature.{namespace}</span></code>
key.</li>
<li>Obtain the compatible feature names, in order. For every feature
name that is not present in the constructed list, append it to
the end.</li>
</ol>
<p>After this step, a list of ordered feature names is available for
every namespace. This is <code class="docutils literal notranslate"><span class="pre">feature_order</span></code> in the example.</p>
</li>
<li>For every feature:<ol class="lowerroman simple">
<li>Construct the initial ordered list of values by copying the value
of the respective
<code class="docutils literal notranslate"><span class="pre">default-priorities.property.{namespace}.{feature_name}</span></code> key.</li>
<li>Obtain the compatible feature values, in order. For every value
that is not present in the constructed list, append it to the
end.</li>
</ol>
<p>After this step, a list of ordered property values is available for
every feature. This is <code class="docutils literal notranslate"><span class="pre">value_order</span></code> in the example.</p>
</li>
<li>For every compatible variant, determine the most preferred value
corresponding to every feature in that variant. This is done by
finding among the values present in the variant properties the one
that has the lowest position in the ordered property value list.
After this step, a list of features along with their best values
is available for every variant. This is done in the
<code class="docutils literal notranslate"><span class="pre">Variant.best_value_properties()</span></code> method in the example.</li>
<li>For every item in the list constructed in the previous step,
construct a sort key that is a 3-tuple consisting of
its namespace, feature name and best feature value indices in the
respective ordered lists. This is done by the <code class="docutils literal notranslate"><span class="pre">property_key()</span></code>
function in the example.</li>
<li>For every compatible variant, sort the list constructed in step 4
using the sort keys constructed in step 5, in ascending order. This
is done by the <code class="docutils literal notranslate"><span class="pre">Variant.sorted_properties()</span></code> method in the example.</li>
<li>To order variants, compare their sorted lists from step 6. If the
sort keys at the first position are different, the variant with the
lower key is sorted earlier. If they are the same, compare the keys
at the second position, and so on, until either a tie-breaker is
found or the list in one of the variants is exhausted. In the latter
case, the variant with more keys is sorted earlier. As a fallback,
if both variants have the same number of keys, they are ordered
lexically by their variant label, ascending. This is done by the
ultimate step of the example algorithm, with the comparison function
being implemented as <code class="docutils literal notranslate"><span class="pre">Variant.__lt__()</span></code>.</li>
</ol>
<p>After this process, the variant wheels are sorted from the most
preferred to the least preferred. The algorithm sorts the null variant
after all the other variants. The non-variant wheel MUST be ordered
after the null variant. Multiple wheels with the same variant property
set (and multiple non-variant wheels) MUST then be ordered according to
their platform compatibility tags.</p>
<p>The tools MAY provide options to override the default ordering, for
example by specifying a preference for specific namespaces, features
or properties. The tools MAY also provide options to exclude specific
variants, or to select a particular variant.</p>
<p>Alternatively, the sort algorithm for variant wheels could be described
using the following pseudocode. For simplicity, this code does not
account for non-variant wheels or tags.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Self</span>


<span class="k">def</span><span class="w"> </span><span class="nf">get_compatible_feature_names</span><span class="p">(</span><span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get an ordered list of compatible features&quot;&quot;&quot;</span>
    <span class="o">...</span>


<span class="k">def</span><span class="w"> </span><span class="nf">get_compatible_feature_values</span><span class="p">(</span><span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">feature_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get an ordered list of compatible values&quot;&quot;&quot;</span>
    <span class="o">...</span>


<span class="c1"># default-priorities dict from index-level metadata</span>
<span class="n">default_priorities</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;namespace&quot;</span><span class="p">:</span> <span class="p">[</span><span class="o">...</span><span class="p">],</span>  <span class="c1"># : list[str]</span>
    <span class="s2">&quot;feature&quot;</span><span class="p">:</span> <span class="p">{</span><span class="o">...</span><span class="p">},</span>  <span class="c1"># : dict[str, list[str]]</span>
    <span class="s2">&quot;property&quot;</span><span class="p">:</span> <span class="p">{</span><span class="o">...</span><span class="p">},</span>  <span class="c1"># : dict[str, dict[str, list[str]]]</span>
<span class="p">}</span>

<span class="c1"># 1. Construct the ordered list of namespaces.</span>
<span class="n">namespace_order</span> <span class="o">=</span> <span class="n">default_priorities</span><span class="p">[</span><span class="s2">&quot;namespace&quot;</span><span class="p">]</span>
<span class="n">feature_order</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">value_order</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">namespace</span> <span class="ow">in</span> <span class="n">namespace_order</span><span class="p">:</span>
    <span class="c1"># 2. Construct the ordered lists of feature names.</span>
    <span class="n">feature_order</span><span class="p">[</span><span class="n">namespace</span><span class="p">]</span> <span class="o">=</span> <span class="n">default_priorities</span><span class="p">[</span><span class="s2">&quot;feature&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="p">[])</span>
    <span class="k">for</span> <span class="n">feature_name</span> <span class="ow">in</span> <span class="n">get_compatible_feature_names</span><span class="p">(</span><span class="n">namespace</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">feature_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">feature_order</span><span class="p">[</span><span class="n">namespace</span><span class="p">]:</span>
            <span class="n">feature_order</span><span class="p">[</span><span class="n">namespace</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feature_name</span><span class="p">)</span>

    <span class="n">value_order</span><span class="p">[</span><span class="n">namespace</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">feature_name</span> <span class="ow">in</span> <span class="n">feature_order</span><span class="p">[</span><span class="n">namespace</span><span class="p">]:</span>
        <span class="c1"># 3. Construct the ordered lists of feature values.</span>
        <span class="n">value_order</span><span class="p">[</span><span class="n">namespace</span><span class="p">][</span><span class="n">feature_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">default_priorities</span><span class="p">[</span><span class="s2">&quot;property&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">feature_name</span><span class="p">,</span> <span class="p">[])</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">feature_value</span> <span class="ow">in</span> <span class="n">get_compatible_feature_values</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="n">feature_name</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">feature_value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">value_order</span><span class="p">[</span><span class="n">namespace</span><span class="p">][</span><span class="n">feature_name</span><span class="p">]:</span>
                <span class="n">value_order</span><span class="p">[</span><span class="n">namespace</span><span class="p">][</span><span class="n">feature_name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feature_value</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">best_value_property</span><span class="p">(</span><span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">feature_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">feature_values</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper function to determine the best value for given feature&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">best_value</span> <span class="ow">in</span> <span class="n">value_order</span><span class="p">[</span><span class="n">namespace</span><span class="p">][</span><span class="n">feature_name</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">best_value</span> <span class="ow">in</span> <span class="n">feature_values</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">best_value</span>
    <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;No feature value supported, wheel should have been filtered out&quot;</span>


<span class="k">def</span><span class="w"> </span><span class="nf">property_key</span><span class="p">(</span><span class="n">prop</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Construct a sort key for variant property (akin to step 5.)&quot;&quot;&quot;</span>
    <span class="n">namespace</span><span class="p">,</span> <span class="n">feature_name</span><span class="p">,</span> <span class="n">feature_value</span> <span class="o">=</span> <span class="n">prop</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">namespace_order</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">namespace</span><span class="p">),</span>
        <span class="n">feature_order</span><span class="p">[</span><span class="n">namespace</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">feature_name</span><span class="p">),</span>
        <span class="n">value_order</span><span class="p">[</span><span class="n">namespace</span><span class="p">][</span><span class="n">feature_name</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">feature_value</span><span class="p">),</span>
    <span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Variant</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Example class exposing properties of a variant wheel&quot;&quot;&quot;</span>

    <span class="n">label</span><span class="p">:</span> <span class="nb">str</span>
    <span class="c1"># {namespace: {feature_name: [feature_values]}}, as in variant.json</span>
    <span class="n">properties</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">best_value_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">Self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Determine the most preferred values for every feature, step 4.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="p">(</span>
                <span class="n">namespace</span><span class="p">,</span>
                <span class="n">feature_name</span><span class="p">,</span>
                <span class="n">best_value_property</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="n">feature_name</span><span class="p">,</span> <span class="n">feature_values</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">features</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">feature_name</span><span class="p">,</span> <span class="n">feature_values</span> <span class="ow">in</span> <span class="n">features</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">sorted_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">Self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sort the list of features with their best values (step 6.)&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">best_value_properties</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="n">property_key</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">Self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Variant comparison function for sorting (part of step 7.)&quot;&quot;&quot;</span>
        <span class="n">self_properties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sorted_properties</span><span class="p">()</span>
        <span class="n">other_properties</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">sorted_properties</span><span class="p">()</span>
        <span class="c1"># Proceed from the first to the last common sort best-value property.</span>
        <span class="c1"># If any of them are different, the variant with better property wins.</span>
        <span class="k">for</span> <span class="n">self_prop</span><span class="p">,</span> <span class="n">other_prop</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">self_properties</span><span class="p">,</span> <span class="n">other_properties</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">self_prop</span> <span class="o">!=</span> <span class="n">other_prop</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">property_key</span><span class="p">(</span><span class="n">self_prop</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">property_key</span><span class="p">(</span><span class="n">other_prop</span><span class="p">)</span>
        <span class="c1"># If the best-value properties of one variant are a subset of another,</span>
        <span class="c1"># the one with more properties wins.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">self_properties</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">other_properties</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">self_properties</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">other_properties</span><span class="p">)</span>
        <span class="c1"># If two variants have exactly the same properties, fall back to</span>
        <span class="c1"># sorting on variant label (they must be unique).</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">label</span>


<span class="c1"># A list of variants to sort.</span>
<span class="n">variants</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Variant</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="o">...</span><span class="p">]</span>


<span class="c1"># 7. Order variants by comparing their sorted properties</span>
<span class="c1"># (see Variant.__lt__())</span>
<span class="n">variants</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="environment-markers">
<h3><a class="toc-backref" href="#environment-markers" role="doc-backlink">Environment markers</a></h3>
<p>Four new <a class="reference external" href="https://packaging.python.org/en/latest/specifications/dependency-specifiers/#dependency-specifiers-environment-markers" title="(in Python Packaging User Guide)"><span class="xref std std-ref">environment markers</span></a> are introduced in
dependency specifications:</p>
<ol class="arabic simple">
<li><code class="docutils literal notranslate"><span class="pre">variant_namespaces</span></code> corresponding to the set of namespaces of all
the variant properties that the wheel variant was built for.</li>
<li><code class="docutils literal notranslate"><span class="pre">variant_features</span></code> corresponding to the set of
<code class="docutils literal notranslate"><span class="pre">namespace</span> <span class="pre">::</span> <span class="pre">feature</span></code> pairs of all the variant properties that the
wheel variant was built for.</li>
<li><code class="docutils literal notranslate"><span class="pre">variant_properties</span></code> corresponding to the set of
<code class="docutils literal notranslate"><span class="pre">namespace</span> <span class="pre">::</span> <span class="pre">feature</span> <span class="pre">::</span> <span class="pre">value</span></code> tuples of all the variant
properties that the wheel variant was built for.</li>
<li><code class="docutils literal notranslate"><span class="pre">variant_label</span></code> corresponding to the exact variant label that the
wheel was built with. For the non-variant wheel, it is an empty
string.</li>
</ol>
<p>The markers evaluating to sets of strings MUST be matched via the <code class="docutils literal notranslate"><span class="pre">in</span></code>
or <code class="docutils literal notranslate"><span class="pre">not</span> <span class="pre">in</span></code> operator, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># satisfied by any &quot;foo :: * :: *&quot; property</span>
<span class="n">dep1</span><span class="p">;</span> <span class="s2">&quot;foo&quot;</span> <span class="ow">in</span> <span class="n">variant_namespaces</span>
<span class="c1"># satisfied by any &quot;foo :: bar :: *&quot; property</span>
<span class="n">dep2</span><span class="p">;</span> <span class="s2">&quot;foo :: bar&quot;</span> <span class="ow">in</span> <span class="n">variant_features</span>
<span class="c1"># satisfied only by &quot;foo :: bar :: baz&quot; property</span>
<span class="n">dep3</span><span class="p">;</span> <span class="s2">&quot;foo :: bar :: baz&quot;</span> <span class="ow">in</span> <span class="n">variant_properties</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">variant_label</span></code> marker is a plain string:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># satisfied by the variant &quot;foobar&quot;</span>
<span class="n">dep4</span><span class="p">;</span> <span class="n">variant_label</span> <span class="o">==</span> <span class="s2">&quot;foobar&quot;</span>
<span class="c1"># satisfied by any wheel other other than the null variant</span>
<span class="c1"># (including the non-variant wheel)</span>
<span class="n">dep5</span><span class="p">;</span> <span class="n">variant_label</span> <span class="o">!=</span> <span class="s2">&quot;null&quot;</span>
<span class="c1"># satisfied by the non-variant wheel</span>
<span class="n">dep6</span><span class="p">;</span> <span class="n">variant_label</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span>
</pre></div>
</div>
<p>Implementations MUST ignore differences in whitespace while matching the
features and properties.</p>
<p>Variant marker expressions MUST be evaluated against the variant
properties stored in the wheel being installed.</p>
</section>
<section id="integration-with-pylock-toml">
<h3><a class="toc-backref" href="#integration-with-pylock-toml" role="doc-backlink">Integration with pylock.toml</a></h3>
<p>Variant wheels can be listed in <code class="docutils literal notranslate"><span class="pre">pylock.toml</span></code> file in the same manner
as wheels with different Platform compatibility tags: either all variant
(and non-variant) wheels can be listed, or a subset of them.</p>
<p>A new <code class="docutils literal notranslate"><span class="pre">[packages.variants-json]</span></code> subtable is added to the file. It
MUST inline the contents of the <a class="reference internal" href="#index-level-metadata">index-level metadata</a> file, converting
the JSON structure into the respective TOML types. The <code class="docutils literal notranslate"><span class="pre">$schema</span></code> key
MUST be preserved to facilitate versioning. The tools MAY remove keys
that are not relevant to variant wheels present in <code class="docutils literal notranslate"><span class="pre">pylock.toml</span></code>.</p>
<p>If variant wheels are listed, the tool SHOULD resolve variants to select
the best wheel file.</p>
<section id="proposed-specification-update">
<h4><a class="toc-backref" href="#proposed-specification-update" role="doc-backlink">Proposed specification update</a></h4>
<p>The proposed text for <a class="reference external" href="https://packaging.python.org/en/latest/specifications/pylock-toml/" title="(in Python Packaging User Guide)"><span>pylock.toml Specification</span></a>
follows:</p>
<section id="packages-variant-json">
<h5><a class="toc-backref" href="#packages-variant-json" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">[packages.variant_json]</span></code></a></h5>
<ul class="simple">
<li><strong>Type</strong>: table</li>
<li><strong>Required?</strong>: no</li>
<li><strong>Functions</strong>:<ul>
<li>Inline variant selection metadata for the package.</li>
<li>The structure of this table MUST conform to the JSON Schema.</li>
<li>Tools that support variant-aware resolution MUST validate this table
against the referenced schema.</li>
<li>Tools that do not support variant-aware resolution MAY ignore this table
but SHOULD preserve it when rewriting the lock file.</li>
</ul>
</li>
</ul>
</section>
</section>
<section id="id1">
<h4><a class="toc-backref" href="#id1" role="doc-backlink">Example</a></h4>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="n">lock-version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;1.0&quot;</span>
<span class="n">created-by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;uv&quot;</span>
<span class="n">requires-python</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&gt;=3.14&quot;</span>

<span class="k">[[packages]]</span>
<span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;numpy&quot;</span>
<span class="n">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;2.3.4&quot;</span>
<span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;https://pypi.anaconda.org/mgorny/simple&quot;</span>
<span class="n">wheels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="n">url</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;https://pypi.anaconda.org/mgorny/simple/numpy/2.3.4/numpy-2.3.4-cp314-cp314-linux_x86_64-openblas.whl&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">hashes</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="n">url</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;https://pypi.anaconda.org/mgorny/simple/numpy/2.3.4/numpy-2.3.4-cp314-cp314-linux_x86_64-x8664v4_mkl.whl&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">hashes</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="n">url</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;https://pypi.anaconda.org/mgorny/simple/numpy/2.3.4/numpy-2.3.4-cp314-cp314-macosx_13_0_x86_64-accelerate.whl&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">hashes</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="n">url</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;https://pypi.anaconda.org/mgorny/simple/numpy/2.3.4/numpy-2.3.4-cp314-cp314-macosx_13_0_x86_64-openblas.whl&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">hashes</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="p">},</span>
<span class="p">]</span>

<span class="k">[packages.variant_json]</span>
<span class="s2">&quot;$schema&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;https://variants-schema.wheelnext.dev/peps/825/v0.1.0.json&quot;</span>

<span class="k">[packages.variant_json.default-priorities]</span>
<span class="n">namespace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">&quot;x86_64&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;aarch64&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;blas_lapack&quot;</span><span class="w"> </span><span class="p">]</span>

<span class="k">[packages.variant_json.variants]</span>
<span class="n">null</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>
<span class="n">x8664v3_openblas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;blas_lapack&quot;</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;library&quot;</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;openblas&quot;</span><span class="p">]},</span><span class="w"> </span><span class="s2">&quot;x86_64&quot;</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;level&quot;</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;v3&quot;</span><span class="p">]}</span><span class="w">  </span><span class="p">}</span>
<span class="n">x8664v4_mkl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;blas_lapack&quot;</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;library&quot;</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;mkl&quot;</span><span class="p">]},</span><span class="w"> </span><span class="s2">&quot;x86_64&quot;</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;level&quot;</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;v4&quot;</span><span class="p">]}</span><span class="w">  </span><span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="suggested-implementation-logic-for-tools-non-normative">
<h3><a class="toc-backref" href="#suggested-implementation-logic-for-tools-non-normative" role="doc-backlink">Suggested implementation logic for tools (non-normative)</a></h3>
<section id="installing-a-package-from-an-index">
<h4><a class="toc-backref" href="#installing-a-package-from-an-index" role="doc-backlink">Installing a package from an index</a></h4>
<p>When asked to install a version of a package from an index, the proposed
behavior would be to:</p>
<ol class="arabic simple">
<li>Query the remote index for the package in question.</li>
<li>Initially select a package version meeting the version constraints
(this does not need to take variant metadata into account).</li>
<li>Filter available wheels based on Platform Compatibility Tags.</li>
<li>Determine if any of the remaining wheels are variant wheels.
If not, proceed as with non-variant wheels.</li>
<li>If any wheels feature a <a class="reference internal" href="#variant-label">variant label</a>, download the <a class="reference internal" href="#index-level-metadata">index-level
metadata</a> file, <code class="docutils literal notranslate"><span class="pre">{name}-{version}-variants.json</span></code>. If this
file is missing, assume all variant wheels are incompatible and
proceed as with non-variant wheels.</li>
<li>Map the variant labels into sets of variant properties using the
index-level variant metadata file. If any of the labels present in
wheel filenames are missing in the file, assume that the respective
wheels are incompatible.</li>
<li>Obtain the ordered lists of compatible variant properties. The
mechanism for this will be specified in a subsequent PEP.</li>
<li>Filter and order variants based on the lists of compatible
properties, per <a class="reference internal" href="#variant-ordering">variant ordering</a>, and select the most preferred
variant. If no variant wheel matched, use the non-variant wheels by
their rules.</li>
<li>If multiple wheels for a given version share the same variant label,
order them by Platform compatibility tags and build number, and
select the best wheel.</li>
</ol>
<p>Note that steps 4. through 8. are introduced specifically for variant
wheels. The remaining steps correspond to the current installer
behavior.</p>
</section>
<section id="installing-a-local-wheel">
<h4><a class="toc-backref" href="#installing-a-local-wheel" role="doc-backlink">Installing a local wheel</a></h4>
<p>When asked to install a local wheel file, the proposed behavior would be
to:</p>
<ol class="arabic simple">
<li>If no variant label is present in the filename, proceed as with
non-variant wheels.</li>
<li>Verify the wheel compatibility via Platform compatibility tags.</li>
<li>Read the <a class="reference internal" href="#variant-metadata">variant metadata</a> from <code class="docutils literal notranslate"><span class="pre">*.dist-info/variant.json</span></code> inside
the wheel file.</li>
<li>Obtain the ordered lists of compatible variant properties. The
mechanism for this will be specified in a subsequent PEP.</li>
<li>Verify the wheel compatibility via compatible properties.</li>
</ol>
</section>
<section id="publishing-variant-wheels-on-an-index">
<h4><a class="toc-backref" href="#publishing-variant-wheels-on-an-index" role="doc-backlink">Publishing variant wheels on an index</a></h4>
<p>Variant wheels are uploaded to an index just like regular wheels.
There are two possible approaches to publishing the index-level
<code class="docutils literal notranslate"><span class="pre">{name}-{version}-variants.json</span></code> file for every package version:
it can either be prepared and uploaded by the user, or it can be
generated automatically by the index.</p>
<p>If the index is responsible for generating the file, it should use some
mechanism to defer publishing it until the release is fully uploaded
(for example, <a class="pep reference internal" href="../pep-0694/" title="PEP 694 – Upload 2.0 API for Python Package Indexes">PEP 694</a>).</p>
<p>To generate the <code class="docutils literal notranslate"><span class="pre">{name}-{version}-variants.json</span></code> file:</p>
<ol class="arabic simple">
<li>For the first variant wheel for a given package version, copy the
data from its <code class="docutils literal notranslate"><span class="pre">*.dist-info/variant.json</span></code> file.</li>
<li>For subsequent wheels, merge the data from their
<code class="docutils literal notranslate"><span class="pre">*.dist-info/variant.json</span></code> files into the existing data:<ul class="simple">
<li>disjoint keys of <code class="docutils literal notranslate"><span class="pre">variants</span></code> dictionary are merged together</li>
<li>common keys of these dictionaries must have exactly the same value</li>
<li><code class="docutils literal notranslate"><span class="pre">default-priorities.namespace</span></code> list can be replaced if the new
value starts with the old value</li>
<li><code class="docutils literal notranslate"><span class="pre">default-priorities.feature</span></code> and <code class="docutils literal notranslate"><span class="pre">default-priorities.value</span></code>
keys can be added if they were not present in the previous
<code class="docutils literal notranslate"><span class="pre">default-priorities.namespace</span></code> value</li>
</ul>
</li>
</ol>
</section>
</section>
</section>
<section id="rationale">
<h2><a class="toc-backref" href="#rationale" role="doc-backlink">Rationale</a></h2>
<p>Variant wheels use structured <a class="reference internal" href="#variant-properties">variant properties</a> to express
multidimensional wheel compatibility matrices. For example, it permits
expressing that a single variant requires certain CPU and GPU features
independently. It can express both AND-style dependencies (such as
different CPU instruction sets) and OR-style dependencies (such as
different GPUs supported by a single package).</p>
<p>The specification does not impose any formal limits on the number of
properties expressed, and specifically accounts for the possibility of
property sets being very long (for example, a long list of GPUs or CPU
extension sets). To avoid wheel filenames becoming very long, the
property lists are stored inside the wheel and mapped to a short label
that is intended to be human-readable.</p>
<p>To facilitate variant selection while installing from remote index,
the variant metadata is mirrored in a JSON file published on the index.
This enables installers to obtain variant property mapping without
having to fetch individual wheels.</p>
<p>The variant ordering algorithm has been proposed with the assumption
that variant properties take precedence over Platform compatibility
tags, as they are primarily used to express user preferences. This
accounts for possible divergence of platform tags, e.g. because a CUDA
variant may require a different minimal libc version, in which case the
selection should be driven by the desired CUDA preference rather than
incidental platform tag difference.</p>
<p>While the provision of variant properties is deferred to a future PEP to
keep the specification easier to comprehend, a baseline assumption is
made that the compatible properties will be provided in specific order
corresponding to their preference, much like Platform compatibility tags
conventionally are. The variant metadata provides the ability to
override this order at package level. However, namespaces are unordered
by design (e.g. we will not decide upfront which GPU vendors take
precedence) and therefore they always need to be ordered by the package
maintainer.</p>
<p>A concept of null variant is introduced that is distinct from
non-variant wheels to facilitate a transition period. This variant is
always supported by tools implementing this PEP, and takes precedence
over non-variant wheel. It can therefore be used to provide a distinct
fallback for the cases of no other variant being supported and variant
wheels being unsupported altogether. For example, PyTorch could provide
a much smaller null variant that is used when no GPU is supported, and a
fallback non-variant wheel built for the default CUDA version.</p>
<p><code class="docutils literal notranslate"><span class="pre">pylock.toml</span></code> integration inlines the variant metadata to keep the
file standalone. This can avoid the additional network call that would
be required to fetch the file, and avoids having to pin to a specific
hash that could cause problems if the file changed on the index, either
due to the variant metadata being updated or being generated in a way
that does not guarantee stable bytewise output.</p>
</section>
<section id="backwards-compatibility">
<h2><a class="toc-backref" href="#backwards-compatibility" role="doc-backlink">Backwards Compatibility</a></h2>
<p>Variant wheels add an additional <a class="reference internal" href="#variant-label">variant label</a> component to the wheel
filename, causing them to be rejected while verifying the filename. This
permits publishing them on an index alongside non-variant wheels,
without risking previous installer versions accidentally installing
them. It was confirmed that the filename validation algorithms in tools
commonly used today reject it:</p>
<ul>
<li>If both the build tag and the variant label are present, the filename
contains too many components. Example:<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>numpy-2.3.2-1-cp313-cp313t-musllinux_1_2_x86_64-x86_64_v3.whl
                                               ^^^^^^^^^^
</pre></div>
</div>
</li>
<li>If only the variant label is present, the Python tag at third position
will be misinterpreted as a build number. Since the build number must
start with a digit and Python tags do not start with digits,
the filename is considered invalid. Example:<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>numpy-2.3.2-cp313-cp313t-musllinux_1_2_x86_64-x86_64_v3.whl
            ^^^^^
</pre></div>
</div>
</li>
</ul>
<p>The addition of the variant label increases the filename length. On platforms
with a low total path length limit such as Windows, long filenames are a
concern. However, given that the name and version components are already
unrestricted, we do not set a specific limit in this PEP. Others, such as PyPI,
may set a limit for total filename length.</p>
<p>Aside from this explicit incompatibility, the specification makes
minimal and non-intrusive changes to the binary package format. The
<a class="reference internal" href="#variant-metadata">variant metadata</a> is stored in a separate file in the <code class="docutils literal notranslate"><span class="pre">.dist-info</span></code>
directory. Tools that are not directly concerned with variants need only
to update their filename verification algorithm (if there is one) and
preserve the contents of said directory.</p>
<p>If the new <a class="reference internal" href="#environment-markers">environment markers</a> are used in wheel dependencies, these
wheels will be incompatible with existing tools. For example, upon
meeting these markers in a dependency from an index, pip will backtrack and
use an older dependency version (if possible). This is a general problem
with the design of environment markers, and not specific to wheel
variants. It is possible to work around it by partially evaluating
environment markers at build time, and removing the markers or
dependencies specific to variant wheels from the non-variant wheel.</p>
</section>
<section id="security-implications">
<h2><a class="toc-backref" href="#security-implications" role="doc-backlink">Security Implications</a></h2>
<p>The presence of variant wheels may lead to some of the variants being
subject to less scrutiny than others, and as such becoming easier attack
targets. Particularly, once variant wheel support becomes commonplace,
the non-variant wheels for some packages may be only consumed by users
with outdated tools. However, such attacks assume that the package
publishing workflow is already compromised, in which case more plausible
attack vectors are available, for example via modifying compiled
extensions.</p>
</section>
<section id="how-to-teach-this">
<h2><a class="toc-backref" href="#how-to-teach-this" role="doc-backlink">How to Teach This</a></h2>
<p>This PEP is oriented at tool authors. Its changes will be integrated
into <a class="reference external" href="https://packaging.python.org/en/latest/specifications/binary-distribution-format/" title="(in Python Packaging User Guide)"><span>Binary distribution format</span></a> and
other PyPA specifications. Teaching variants to end users will be
covered in a subsequent PEP, as user experience details are addressed.</p>
</section>
<section id="reference-implementation">
<h2><a class="toc-backref" href="#reference-implementation" role="doc-backlink">Reference Implementation</a></h2>
<p>The <a class="reference external" href="https://github.com/wheelnext/variantlib">variantlib</a> project
contains a reference implementation of a complete variant wheel
solution. It is compliant with this PEP, but also goes beyond it,
providing example solutions to <a class="reference internal" href="#open-issues">open issues</a>.</p>
<p>A client for installing variant wheels is implemented in a
<a class="reference external" href="https://github.com/astral-sh/uv/pull/12203">uv branch</a>.</p>
</section>
<section id="rejected-ideas">
<h2><a class="toc-backref" href="#rejected-ideas" role="doc-backlink">Rejected Ideas</a></h2>
<section id="predictable-variant-labels">
<h3><a class="toc-backref" href="#predictable-variant-labels" role="doc-backlink">Predictable variant labels</a></h3>
<p>The specification proposes that variant labels are arbitrary, and
variant properties are mapped to them via a <a class="reference internal" href="#variant-metadata">variant metadata</a> file
rather than expressed directly in them. While it could be technically
possible to create variant labels from variant properties, this would
either require permitting very long filenames that will cause issues
with some platforms, or imposing arbitrary limits on variant property
counts, making the specification less suitable for addressing
multidimensional compatibility matrices.</p>
<p>An alternative approach was to use a hash of variant properties. While
such an approach is technically valid and can provide short unique
labels for arbitrarily large variant property sets, it makes the labels
opaque and therefore difficult to read or reason about.</p>
</section>
<section id="variant-label-as-part-of-platform-compatibility-tag">
<h3><a class="toc-backref" href="#variant-label-as-part-of-platform-compatibility-tag" role="doc-backlink">Variant label as part of Platform compatibility tag</a></h3>
<p>The specification adds the variant label as a separate component,
therefore breaking compatibility with existing tools. It could be
technically possible to preserve partial compatibility by appending it
to one of the Platform compatibility tags instead, in which case
installers would reject the wheel based on platform (or Python
interpreter) incompatibility, while other tools could still use it.
However, the authors decided it safer to break the backwards
compatibility. Additionally, reusing tags posed a potential risk of
wheel labels being incorrectly combined with compressed tag sets. For
example, a <code class="docutils literal notranslate"><span class="pre">manylinux_2_27_x86_64.manylinux_2_28_x86_64+x8664v3</span></code> tag
would be incorrectly deemed compatible because of the
<code class="docutils literal notranslate"><span class="pre">manylinux_2_27_x86_64</span></code> part.</p>
</section>
</section>
<section id="open-issues">
<h2><a class="toc-backref" href="#open-issues" role="doc-backlink">Open Issues</a></h2>
<p>The following problems are deferred to subsequent PEPs:</p>
<ul class="simple">
<li>governance of variant namespaces</li>
<li>determining which variant properties are compatible with the system</li>
<li>building variant wheels</li>
</ul>
</section>
<section id="acknowledgements">
<h2><a class="toc-backref" href="#acknowledgements" role="doc-backlink">Acknowledgements</a></h2>
<p>This work would not have been possible without the contributions and
feedback of many people in the Python packaging community. In
particular, we would like to credit the following individuals for their
help in shaping this PEP (in alphabetical order):</p>
<p>Alban Desmaison, Bradley Dice, Chris Gottbrath, Dmitry Rogozhkin,
Emma Smith, Geoffrey Thomas, Henry Schreiner, Jeff Daily, Jeremy Tanner,
Jithun Nair, Keith Kraus, Leo Fang, Mike McCarty, Nikita Shulga,
Paul Ganssle, Philip Hyunsu Cho, Robert Maynard, Vyas Ramasubramani,
and Zanie Blue.</p>
</section>
<section id="change-history">
<h2><a class="toc-backref" href="#change-history" role="doc-backlink">Change History</a></h2>
<ul class="simple">
<li>17-Feb-2026<ul>
<li>Initial version, split from <a class="pep reference internal" href="../pep-0817/" title="PEP 817 – Wheel Variants: Beyond Platform Tags">PEP 817</a> draft.</li>
<li>Corrected the variant ordering algorithm to order variants per the
best value that is compatible with the system, for every feature,
rather than all compatible values, and add a fallback to ordering
on variant label.</li>
<li>Removed the variant label length limitation.</li>
<li>Changed <code class="docutils literal notranslate"><span class="pre">pylock.toml</span></code> integration to inline variant metadata
rather than storing a URL and a hash.</li>
</ul>
</li>
</ul>
</section>
<section id="appendices">
<h2><a class="toc-backref" href="#appendices" role="doc-backlink">Appendices</a></h2>
<ul class="simple">
<li><a class="reference internal" href="appendix-variant-json-schema/#pep825-variant-json-schema"><span class="std std-ref">Appendix: JSON Schema for Variant Metadata</span></a></li>
</ul>
</section>
<section id="copyright">
<h2><a class="toc-backref" href="#copyright" role="doc-backlink">Copyright</a></h2>
<p>This document is placed in the public domain or under the
CC0-1.0-Universal license, whichever is more permissive.</p>
</section>
</section>
<hr class="docutils" />
<p>Source: <a class="reference external" href="https://github.com/python/peps/blob/main/peps/pep-0825.rst">https://github.com/python/peps/blob/main/peps/pep-0825.rst</a></p>
<p>Last modified: <a class="reference external" href="https://github.com/python/peps/commits/main/peps/pep-0825.rst">2026-02-27 19:25:53 GMT</a></p>

        </article>
        <nav id="pep-sidebar">
            <div id="search"></div>
            <h2>Contents</h2>
            <ul>
<li><a class="reference internal" href="#abstract">Abstract</a></li>
<li><a class="reference internal" href="#motivation">Motivation</a></li>
<li><a class="reference internal" href="#specification">Specification</a><ul>
<li><a class="reference internal" href="#definitions">Definitions</a></li>
<li><a class="reference internal" href="#variant-wheel">Variant wheel</a></li>
<li><a class="reference internal" href="#variant-properties">Variant properties</a></li>
<li><a class="reference internal" href="#variant-label">Variant label</a></li>
<li><a class="reference internal" href="#variant-metadata">Variant metadata</a><ul>
<li><a class="reference internal" href="#schema">Schema</a></li>
<li><a class="reference internal" href="#default-priorities">Default priorities</a></li>
<li><a class="reference internal" href="#variants">Variants</a></li>
<li><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#index-level-metadata">Index-level metadata</a></li>
<li><a class="reference internal" href="#variant-ordering">Variant ordering</a></li>
<li><a class="reference internal" href="#environment-markers">Environment markers</a></li>
<li><a class="reference internal" href="#integration-with-pylock-toml">Integration with pylock.toml</a><ul>
<li><a class="reference internal" href="#proposed-specification-update">Proposed specification update</a><ul>
<li><a class="reference internal" href="#packages-variant-json"><code class="docutils literal notranslate"><span class="pre">[packages.variant_json]</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#id1">Example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#suggested-implementation-logic-for-tools-non-normative">Suggested implementation logic for tools (non-normative)</a><ul>
<li><a class="reference internal" href="#installing-a-package-from-an-index">Installing a package from an index</a></li>
<li><a class="reference internal" href="#installing-a-local-wheel">Installing a local wheel</a></li>
<li><a class="reference internal" href="#publishing-variant-wheels-on-an-index">Publishing variant wheels on an index</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#rationale">Rationale</a></li>
<li><a class="reference internal" href="#backwards-compatibility">Backwards Compatibility</a></li>
<li><a class="reference internal" href="#security-implications">Security Implications</a></li>
<li><a class="reference internal" href="#how-to-teach-this">How to Teach This</a></li>
<li><a class="reference internal" href="#reference-implementation">Reference Implementation</a></li>
<li><a class="reference internal" href="#rejected-ideas">Rejected Ideas</a><ul>
<li><a class="reference internal" href="#predictable-variant-labels">Predictable variant labels</a></li>
<li><a class="reference internal" href="#variant-label-as-part-of-platform-compatibility-tag">Variant label as part of Platform compatibility tag</a></li>
</ul>
</li>
<li><a class="reference internal" href="#open-issues">Open Issues</a></li>
<li><a class="reference internal" href="#acknowledgements">Acknowledgements</a></li>
<li><a class="reference internal" href="#change-history">Change History</a></li>
<li><a class="reference internal" href="#appendices">Appendices</a></li>
<li><a class="reference internal" href="#copyright">Copyright</a></li>
</ul>

            <br>
            <a id="source" href="https://github.com/python/peps/blob/main/peps/pep-0825.rst?plain=1">Page Source (GitHub)</a>
        </nav>
    </section>
    <script src="../_static/colour_scheme.js"></script>
    <script src="../_static/wrap_tables.js"></script>
    <script src="../_static/sticky_banner.js"></script>
    <script src="https://analytics.python.org/js/script.outbound-links.js"
            data-domain="peps.python.org" defer></script>
    <script src="/pagefind/pagefind-ui.js"></script>
    <script>
        window.addEventListener('DOMContentLoaded', (event) => {
            // Ranking configuration to boost exact title matches
            const searchOptions = {
                ranking: {
                    termSimilarity: 9.0, // Higher values favor exact matches
                    termFrequency: 0.5, // Lower values reduce penalty for low term frequency
                    pageLength: 0.2, // Lower values reduce the impact of page length
                }
            };

            // Initialize pagefind for either mobile or desktop, not both
            if (window.innerWidth <= 640) {
                new PagefindUI({ element: "#mobile-search", ...searchOptions, showSubResults: false });
            } else {
                new PagefindUI({ element: "#search", ...searchOptions, showSubResults: true });
            }
        });
    </script>
</body>
</html>